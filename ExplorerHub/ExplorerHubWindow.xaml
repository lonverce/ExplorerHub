<pu:WindowX x:Class="ExplorerHub.ExplorerHubWindow"
            xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
            xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
            xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
            xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
            xmlns:pu="clr-namespace:Panuon.UI.Silver;assembly=Panuon.UI.Silver"
            mc:Ignorable="d" 
            xmlns:dd="clr-namespace:GongSolutions.Wpf.DragDrop;assembly=GongSolutions.WPF.DragDrop"
            xmlns:explorerHub="clr-namespace:ExplorerHub"
            xmlns:explorerHubs="clr-namespace:ExplorerHub.ViewModels.ExplorerHubs"
            xmlns:explorers="clr-namespace:ExplorerHub.ViewModels.Explorers"
            pu:WindowXCaption.Background="{DynamicResource {x:Static SystemColors.ActiveCaptionBrushKey}}"
            Title="文件资源管理器" 
            Height="700" Width="1000"
            d:DataContext="{d:DesignInstance explorerHubs:ExplorerHubViewModel}" 
            Padding="0">
    <pu:WindowX.Resources>
        <Style TargetType="Button"
               BasedOn="{StaticResource {x:Type Button}}">
            <Setter Property="pu:ButtonHelper.ButtonStyle" 
                    Value="Outline"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Style.Triggers>
                <DataTrigger Binding="{Binding Path=(pu:ButtonHelper.ButtonStyle),RelativeSource={RelativeSource Self}, Mode=OneWay}"
                             Value="Outline">
                    <Setter Property="pu:ButtonHelper.ClickStyle"
                            Value="Sink"/>
                    <Setter Property="Padding" Value="5,3"/>
                    <Setter Property="BorderThickness" Value="0"></Setter>
                    <Setter Property="VerticalAlignment" Value="Center"/>
                    <Setter Property="Margin" Value="3,0"></Setter>
                </DataTrigger>
            </Style.Triggers>
        </Style>
    </pu:WindowX.Resources>
    <pu:WindowXCaption.Header>
        <StackPanel Orientation="Horizontal">
            <ListBox Name="ExplorerHeaderBar" 
                     ItemsSource="{Binding Explorers}" 
                     BorderThickness="0" 
                     HorizontalAlignment="Left" 
                     Margin="0" 
                     dd:DragDrop.IsDragSource="True"
                     dd:DragDrop.IsDropTarget="True"
                     dd:DragDrop.DropHandler="{Binding DropTarget}"
                     Background="Transparent"
                     pu:ListBoxHelper.HoverBackground="{DynamicResource {x:Static SystemColors.InactiveCaptionBrushKey}}"
                     pu:ListBoxHelper.SelectedBackground="White"
                     SelectionMode="Single"
                     SelectedIndex="{Binding SelectedIndex, Mode=TwoWay}"
                     Padding="0"
                     ScrollViewer.HorizontalScrollBarVisibility="Disabled">
                <ListBox.ItemContainerStyle>
                    <Style TargetType="ListBoxItem" BasedOn="{StaticResource {x:Type ListBoxItem}}">
                        <Setter Property="Padding" Value="0"/>
                        <Setter Property="VerticalAlignment" Value="Stretch"/>
                        <Setter Property="Margin" Value="0"/>
                        <Setter Property="Height" Value="{Binding ElementName=ExplorerHeaderBar, Path=ActualHeight, Mode=OneWay}"/>
                        <Setter Property="ContextMenu">
                            <Setter.Value>
                                <ContextMenu d:DataContext="{d:DesignInstance explorers:ExplorerViewModel}">
                                    <MenuItem Header="在新窗口中打开"
                                              Command="{Binding ShowInNewWindowCommand}">
                                        <MenuItem.Icon>
                                            <TextBlock FontFamily="{StaticResource FontAwesome}">&#xf08e;</TextBlock>
                                        </MenuItem.Icon>
                                    </MenuItem>
                                </ContextMenu>
                            </Setter.Value>
                        </Setter>
                    </Style>
                </ListBox.ItemContainerStyle>
                <ListBox.ItemsPanel>
                    <ItemsPanelTemplate>
                        <WrapPanel Orientation="Horizontal" 
                                   Background="Transparent" 
                                   Margin="0" 
                                   
                                   HorizontalAlignment="Left" VerticalAlignment="Center" 
                                   IsItemsHost="True" />
                    </ItemsPanelTemplate>
                </ListBox.ItemsPanel>
                <ListBox.ItemTemplate>
                    <DataTemplate DataType="explorers:ExplorerViewModel">
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Left" Margin="0">
                            <StackPanel Orientation="Horizontal" 
                                        HorizontalAlignment="Left">
                                <Image Source="{Binding Logo}" Width="15" Height="15" Margin="3, 2" VerticalAlignment="Center" />
                                <TextBlock Text="{Binding Title, Mode=OneWay, TargetNullValue=新标签}"
                                           VerticalAlignment="Center" MaxWidth="120" TextTrimming="CharacterEllipsis" Padding="5,0" />
                            </StackPanel>
                            <Button FontFamily="{StaticResource FontAwesome}" 
                                    Content="&#xf00d;" Background="Transparent" 
                                    BorderThickness="0" 
                                    Command="{Binding ElementName=ExplorerHeaderBar, Path=DataContext.CloseBrowserCommand}"
                                    CommandParameter="{Binding}"
                                    Foreground="LightSlateGray">
                            </Button>
                        </StackPanel>
                    </DataTemplate>
                </ListBox.ItemTemplate>
            </ListBox>
            <Button Content="&#xf067;" 
                    Command="{Binding AddBrowserCommand}"
                    Margin="10,0" FontFamily="{StaticResource FontAwesome}" 
                    Background="Transparent" 
                    Foreground="DimGray"/>
        </StackPanel>
    </pu:WindowXCaption.Header>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        <DockPanel Grid.Row="0" LastChildFill="True" Margin="3,5" 
                   DataContext="{Binding ElementName=ExplorerHeaderBar, Path=SelectedItem}"
                   d:DataContext="{d:DesignInstance explorers:ExplorerViewModel}">
            <Button DockPanel.Dock="Left"
                                    FontFamily="{StaticResource FontAwesome}"
                                    Content="&#xf060;"
                                    ToolTip="后退"
                                    Command="{Binding NavigateBackwardCommand}"  />
            <Button DockPanel.Dock="Left"
                                    Content="&#xf061;"
                                    FontFamily="{StaticResource FontAwesome}"
                                    ToolTip="前进"
                                    Command="{Binding NavigateForwardCommand}" />
            <Button DockPanel.Dock="Left"
                                    Content="&#xf0aa;"
                                    FontFamily="{StaticResource FontAwesome}"
                                    ToolTip="上一层"
                                    Command="{Binding GoToParentCommand}" />
            <Button DockPanel.Dock="Right" Content="&#xf013;" FontFamily="{StaticResource FontAwesome}"
                                    ToolTip="设置" />

            <Border CornerRadius="15" Background="WhiteSmoke" Margin="5,3" Padding="10,0"
                                    VerticalAlignment="Center"
                                    Name="AddressBar">
                <DockPanel VerticalAlignment="Center">
                    <Image Source="{Binding Logo}" Width="15" Height="15" Margin="3, 2"
                                           VerticalAlignment="Center" />
                    <Button DockPanel.Dock="Right" Content="&#xf006;"
                                            FontFamily="{StaticResource FontAwesome}" ToolTip="添加收藏" />
                    <TextBox TextWrapping="NoWrap" BorderThickness="0"
                                             MaxLines="1" MaxLength="256" IsReadOnly="False" AutoWordSelection="True"
                                             Background="Transparent"
                                             FontFamily="Consola"
                                             Padding="5, 3" VerticalContentAlignment="Center"
                                             Text="{Binding NavigationPath, Mode=OneWay}"
                                             AcceptsReturn="False" 
                                             LostKeyboardFocus="SearchBox_OnLostKeyboardFocus"
                                             GotKeyboardFocus="SearchBox_OnGotKeyboardFocus"
                                             Name="SearchBox">
                        <TextBox.InputBindings>
                            <KeyBinding Key="Enter" Command="{Binding Search}"
                                                        CommandParameter="{Binding RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type TextBox}}, Path=Text}" />
                        </TextBox.InputBindings>
                    </TextBox>
                </DockPanel>
            </Border>
        </DockPanel>
        
        <WindowsFormsHost  MinHeight="200" 
                           Grid.Row="1" 
                           HorizontalAlignment="Stretch" VerticalAlignment="Stretch"
                           Margin="0, 7, 0, 0" 
                           explorerHub:WindowsFormsHostHelper.ChildForm="{Binding ElementName=ExplorerHeaderBar, Path=SelectedItem.(explorers:ExplorerViewModel.Browser), Mode=OneWay}"
        />
    </Grid>
</pu:WindowX>